{% extends 'admin/list.html.twig' %}
{% set _entity_config = easyadmin_entity(app.request.query.get('entity')) %}
{% trans_default_domain _entity_config.translation_domain %}
{% set _trans_parameters = { '%entity_name%': _entity_config.name|trans, '%entity_label%': _entity_config.label|trans } %}

{% block table_class 'table-sortable' %}

{% block table_body %}
    {% for item in paginator.currentPageResults %}
        {% if not easyadmin_is_granted(_entity_config.list.item_permission, item) %}
            {% set _number_of_hidden_results = _number_of_hidden_results + 1 %}
        {% else %}
            {# the empty string concatenation is needed when the primary key is an object (e.g. an Uuid object) #}
            {% set _item_id = '' ~ attribute(item, _entity_config.primary_key_field_name) %}
            <tr data-id="{{ _item_id }}" class="sortable-item">

                {% for field, metadata in _fields_visible_by_user %}
                    {% set isSortingField = metadata.property == app.request.get('sortField') %}
                    {% set isPositionField = field == 'position' %}
                    {% set _column_label =  (metadata.label ?: field|humanize)|trans(_trans_parameters)  %}

                    <td class="{{ isSortingField ? 'sorted' }} {{ metadata.dataType|lower }} {{ metadata.css_class }}" {{ easyadmin_config('design.rtl') ? 'dir="rtl"' }}>
                        {% if isPositionField %}
                            <button type="button" class="btn btn-sm btn-elevate btn-icon sortable-handler"><i class="fas fa-arrows-alt-v"></i></button>
                        {% else %}
                            {{ easyadmin_render_field_for_list_view(_entity_config.name, item, metadata) }}
                        {% endif %}
                    </td>
                {% endfor %}

                {% if _list_item_actions|length > 0 %}
                    {% set _column_label =  'list.row_actions'|trans(_trans_parameters, 'EasyAdminBundle') %}
                    <td class="actions text-right">
                        <div class="dropdown dropdown-inline">
                            <button type="button" class="btn btn-hover-brand btn-elevate-hover btn-icon btn-sm btn-icon-md" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="flaticon-more-1"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                {% block item_actions %}
                                    {{ include('admin/_actions.html.twig', {
                                        actions: _list_item_actions,
                                        entity_config: _entity_config,
                                        request_parameters: _request_parameters,
                                        translation_domain: _entity_config.translation_domain,
                                        trans_parameters: _trans_parameters,
                                        item_id: _item_id,
                                        item: item,
                                        view: 'list'
                                    }, with_context = false) }}
                                {% endblock item_actions %}
                            </div>
                        </div>
                    </td>
                {% endif %}
            </tr>
        {% endif %}
    {% else %}
        <tr>
            <td class="no-results" colspan="{{ _fields_visible_by_user|length + 1 }}">
                {{ 'search.no_results'|trans(_trans_parameters, 'EasyAdminBundle') }}
            </td>
        </tr>
    {% endfor %}

    {% if _number_of_hidden_results > 0 %}
        <tr class="datagrid-row-empty">
            <td class="text-center" colspan="{{ _fields_visible_by_user|length + 1 }}">
                <span class="datagrid-row-empty-message"><i class="fa fa-lock mr-1"></i> {{ 'security.list.hidden_results'|trans({}, 'EasyAdminBundle') }}</span>
            </td>
        </tr>
    {% endif %}
{% endblock table_body %}
